\documentclass[a4paper]{article}

\usepackage[brazil]{babel}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{indentfirst}

\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{hyperref}

\newcommand{\E}[1]{E\!\left[#1\right]}

\newcommand{\arq}{\texttt}
\newcommand{\inlcode}{\texttt}

\title{Relatório Simulador\\
  Avaliação e Desempenho - 2022.1}
\author{Daniel Kiyoshi Hashimoto Vouzella de Andrade - 119025937
  \\
Polyana Tadeu -
  \\
Gustavo Muzy Fraga -
}
\date{}

\begin{document}
\maketitle

\section*{Lembretes}
\begin{itemize}
    \item Tempo médio de serviço é 1 segundo
    \item Disciplinas de fila: FCFS, LCFS
    \item Utilizações/\(\lambda\)s:
    \begin{itemize}
        \item \(0.2\)
        \item \(0.4\)
        \item \(0.6\)
        \item \(0.8\)
        \item \(0.9\)
    \end{itemize}
    \item Definir método para término da fase transiente,
        para cada utilização e disciplina
    \item IC de \(95\%\) e com precisão de \(5\%\),
        ou seja, o tamanho do intervalo deverá ser no máximo
        \(10\%\) do valor do centro do intervalo
    \item \(N = 3200\), número de rodadas
    \item Tem que usar Chi-quadrado e t-Student
    \item Temos que escolher um \(k\), número de saídas registradas,
        mais adequado (vide apostila/slides)
    \begin{itemize}
        \item Pode ser que a precisão da variância
            seja de \(5\%\),
            mas o resultado analíco não esteja dentro do intervalo
            pois \(k\) é muito pequeno e não se aproxima da normal
    \end{itemize}
    \item Métricas, para cada disciplina de fila e utilização:
    \begin{itemize}
        \item Tempo médio de espera na fila
        \item Variância do tempo de espera na fila
        \item Número médio de pessoas na fila de espera
        \item Variância do número médio de pessoas na fila de espera
    \end{itemize}
    \item Na página de rosto descreva
        a participação de cada integrante
\end{itemize}

%\newpage
\section{Introdução}
\subsection{Funcionamento Geral do Simulador}
De forma geral,
o programa é dividido logicamente em arquivos,
onde cada um descreve uma \emph{função}
e, se for moderadamente complexa, possui alguns testes,
gerar números pseudoaleatórios e implementar uma fila,
são exemplos.
O simulador (lógica em \arq{system.c})
apenas retira e trata o evento mais próximo do \emph{instante atual},
possivelmente criando eventos com tempos pseudoaleatorios
e os colocando na lista de eventos e alterando o estado do sistema.
Para a lista de eventos,
utilizamos uma heap de mínimo ordenado pelo tempo do eventos.
O \emph{instante atual}, assim como o tempo de cada evento,
é armazenado em memória como um \inlcode{double}, ou seja,
um float de 64 bits.

\subsection{Eventos}
Foram escolhidos dois tipos de evento:
\begin{itemize}
    \item \textbf{Evento de Chegada}

        Também é o evento inicial do sistema,
        gerado com tempo \(0\)
        pela função \inlcode{add\_first\_event}.
        Quando um evento de chegada é tratado,
        criamos um novo evento de chegada
        e inserimos na lista de eventos.
        Em seguida observamos o estado do servidor;
        se estiver ocupado, apenas
        adicionamos o cliente que chegou
        de acordo com a disciplina da fila.

        Caso o servidor esteja ocioso,
        registramos o tempo de espera
        do cliente que acabou de chegar,
        nesse caso sempre nulo,
        colocamos um evento de saída na lista de eventos,
        e marcamos o servidor como ocupado.

    \item Evento de Saída

        O evento de saída,
        como descrito anteriormente é gerado quando um cliente encontra o servidor ocioso. Ao tratarmos o evento, checamos se a fila está vazia ou não. No caso dela estar vazia, apenas indicamos que o servidor está ocioso. Caso haja clientes na fila, registramos o tempo de espera na fila do próximo cliente a entrar em serviço e geramos um novo evento de saída para ele (colocando este na heap de eventos).
\end{itemize}
\subsection{Estrutura Interna}
Utilizamos várias estruturas, sendo elas:
\begin{itemize}
    \item System

    Esta estrutura guarda todas as variáveis estruturas necessárias para o sistema. As estruturas são:

    \texttt{RandCtx, EventHeap, Queue,
        Stats (Número de pessoas na fila e Tempo de espera)}
    \item RandCtx

    Espaço de memória para guardar o contexto para gerar números pseudoaleatórios

    \item RandTable

    Em conjunto ao RandCtx, utilizamos uma tabela que guarda a sequência de valores pseudoaleatórios da uniforme.

    \item EventHeap

    Utilizamos a estrutura da heap para ordenar os eventos baseado no tempo deles.

    \item Queue

    Uma estrutra de fila simples. Para a disciplina de FCFS utilizamos um buffer circular, pois tanto a head quanto a tail podem ser alterados e para LCFS apenas a calda é expandida.

    \item Stats

    Estrutura para auxiliar as estatisticas. Nela tem n, que é o número de amostras e acc e sqr\_acc que são seus incrementador e incrementador ao quadrado, respectivamente.

    \item CI

    No arquivo de status.c também utilizamos a estrutura CI para calcular o intervalo de confiança. Nela contem o valor superior, o inferior e a precisão do IC.

    \item CachedStats

    Uma estrutura também no arquivo status.c para guardar os valores de média, variança e os intervalos de IC obtidos com o uso da Tstudent e Chi square.

    \item Person

    Estrutura utilizada no arquivo event.c para salvar a cor da pessoa e o tempo de chegada dela no sistema.

    \item Event

    Estrutura utilizada no arquivo event.c para salvar informações como o tipo do evento, a pessoa envolvida e o seu tempo.

\end{itemize}
\subsection{Linguagem Utilizada e Geração das Variáveis Aleatórias}
A linguagem utilizada foi C.
\subsection{Cores}
\subsection{Precisão IC}
\subsection{Médias e Variância}
\subsection{Máquina Utilizada e Tempo Total}

%\newpage
\section{Testes de Correção}
%\newpage
\section{Estimativa da Fase Transiente}

\newpage
\section{Dedução dos Valores Analíticos}
\subsection{Número médio de pessoas na fila}
Vamos analisar a evolução do número
deixado para trás na \(i\)-ésma e \((i+1)\)-ésima partidas.
Seja \(N_i\) e  \(N_{i+1}\) os números de pessoas
deixadas para trás nestes instantes rescpectivamente.
Seja \(K\) o número de chegadas Poisson
durante um serviço \(X\),
com \(K(z) = X^*(\lambda - \lambda \; z)\).

Para uma fila M/M/1 \(\rho = \lambda \; \E{X}\)
\begin{align*}
    K'(1) &= -\lambda \; {X^*}'(0) = \lambda \; \E{X}
        = \rho \\
    K''(1) &= \lambda^2 \; {X^*}''(0)
        = \lambda^2 \; \E{X^2} = 2 \; \rho^2 \\
    K'''(1) &= - \lambda^3 \; {X^*}'''(0)
        = \lambda^3 \; \E{X^3} = 6 \; \rho^3
\end{align*}
Desse modo:
\begin{center}
    COLOCAR IMAGEM
\end{center}
Usando tranformadas e condicionamentos, temos:
\[
    \E{z^{N_{i+1}}}
        = \E{z^{K} | N_i = 0} \; P(N_i = 0)
        + \E{z^{N_{i}+K-1} | N_i > 0} \; P(N_i > 0)
\]
No comportamento limite
\(N_i \Rightarrow N\) e \(N_{i+1} \Rightarrow N\)
com \(i \Rightarrow \infty\),
e para \(\rho < 1 \),
haverá uma distribuição estacionária
do número de pessoas na fila com T.~Z dada por
\(N(z) = \E{z^N}\).
Assim sendo, temos:
\begin{align*}
    \E{z^N} &= \E{z^K | N = 0} \; P(N = 0)
        + \E{z^{N+K-1} | N>0} \; P(N > 0) \\
    &= K(z) \; (1 - \rho)
        + \frac{K(z)}{z} \E{z^N | N > 0} \; \rho
\end{align*}
Entretando, sabemos que:
\begin{align*}
    \E{z^N} &= \E{z^N| N = 0} \; P(N = 0)
        + \E{z^N  | N > 0} \; P(N > 0) \\
    N(z) &= (1 - \rho) + \E{z^N | N > 0} \rho \\
    \E{z^N | N > 0} &= \frac{N(z) - (1 - \rho)}{\rho}
\end{align*}
Substituindo \(\E{z^N | N > 0}\)
na expressão anterior obtemos:
\begin{align*}
    N(z) &= K(z) \; (1 - \rho)
        + \frac{K(z)}{z} \; \frac{N(z) - (1 - \rho)}{\rho}
        \; \rho \\
    N(z) &= \frac{z \; K(z) \; (1 - \rho)
        + K(z) \; N(z) - K(z) \; (1 - \rho)}{z} \\
    z \; N(z) &= z \; K(z) \; (1 - \rho)
        + K(z) \; N(z) - K(z) \; (1 - \rho) \\
    N(z) \; (z - K(z)) &= K(z) \; (1 - \rho) \; (z - 1) \\
    N(z) &= \frac{K(z) \; (1 - \rho) \; (1 - z)}{K(z) - z}
\end{align*}
A partir de N(z),
podemos obter a \(\E{N}\),
uma vez que \(\E{N} = N'(1)\).
Derivando \(N(z)\) pela primeira vez:
\begin{align*}
    N(z) \; (K(z) - z) &= K(z) \; (1 - \rho) \; (1-z) \\
    N'(z) \; (K(z) - z) +  N(z) \; (K'(z) - 1)
        &= (1 - \rho) \; (K'(z) \; (1 - z) - K(z))
\end{align*}
Derivando novamente para retirar as indeterminações:
\begin{align*}
    N''(z) \; (K(z) - z) + N'(z) \; (K'(z) - 1)
        + N'(z) \; (K'(z) - 1) \\
        + N(z) \; (K''(z)) \\
    = (1 - \rho) \; (K''(z) \; (1 - z) - K(z) - K(z))
\end{align*}
\[
   N''(z) \; (K(z) - z) + 2 \; N'(z) \; (K'(z) - 1)
        + N(z) \; (K''(z))
\] \[
    \qquad\qquad \quad
    = (1 - \rho) \; (K''(z) \; (1 - z) - 2 \; K(z))
\]
Fazendo \(z = 1\):
\begin{align*}
    N''(1) \; (K(1) - 1) + 2 \; N'(1) \; (K'(1) - 1)
        + N(1) \; K''(1) \\
        = (1 - \rho) \; (K''(1) \; (1 - 1) - 2 \; K(1))
\end{align*} \begin{align*}
    2 \; N'(1) \; (\lambda \; \E{X} - 1)
        + \lambda^2 \; \E{X^2}
        &= (1 - \rho)(- 2 \; \lambda \; \E{X}) \\
    N'(1) &= \frac{(1 - \rho) \; (2 \; \lambda \; \E{X})
        + \lambda^2 \; \E{X^2}}{1 - \lambda \; \E{X}}
\end{align*}
Para M/M/1:
\[
    N'(1) = \frac{(1 - \rho) \; 2 \; \rho
        + 2 \; \rho^2}{1 - \rho} \\
        = \frac{\rho}{1 - \rho}
\]
Com \(N(z)\) calculada, é fácil achar
o número de pessoas na fila de espera,
uma vez que:
\begin{center}
    COLOCAR IMAGEM
\end{center}
\begin{align*}
    \E{z^{N_q}} &= \E{z^N| N = 0} \; P(N = 0)
        + \E{z^{N-1} | N > 0} \;P(N > 0) \\
    N_q(z) &= (1 - \rho) + \frac{N(z) - (1 - \rho)}{z \; \rho}
        \; \rho \\
    N_q(z) &= \frac{z \; (1 - \rho) + N(z) - (1 - \rho)}{z} \\
    N_q(z) &= \frac{N(z) - (1 - \rho) \; (1 - z)}{z} \\
\end{align*}
Derivando \(N_q(z)\) uma vez para calcular o primeiro momento
\(\E{N_q} = N_q'(1)\):
\begin{align*}
    N_q(z) \; z &= N(z) - (1 - \rho) \; (1 - z) \\
    N_q'(z) \; z + N_q(z) &= N'(z) + (1 - \rho)
\end{align*}
Fazendo \(z = 1\):
\begin{align*}
    N_q'(1) + N_q(1) &= N'(1) + (1 - \rho) \\
    N_q'(1) &= N'(1) - \rho \\
    &= \frac{\rho}{1 - \rho} - \rho \\
    &= \frac{\rho^2}{1 - \rho}
\end{align*}

\subsection{Variância do número de pessoas na fila}
Para achar a variância do número de pessoas na fila,
precisamos encontrar o segundo momento de \(N_q\),
que pode ser dados por \(E[N_q^2] = N_q'(1) + N_q''(1)\),
então precisamos derivar \(N_q(z)\) novamente.
\[
    N_q''(z) \; z + N_q'(z) + N_q'(z) = N''(z)
\]
Fazendo \(z = 1\):
\begin{align*}
    N_q''(1) \; 1 + N_q'(1) \; + N_q'(1) &= N''(1) \\
    N_q''(1) &= N''(1) - 2 \; N_q'(1)
\end{align*}
Logo,
\begin{align*}
    \E{N_q^2} &= N'(1) - \rho + N''(1) - 2 \; N_q'(1) \\
    \E{N_q^2} &= N'(1) - \rho + N''(1) - 2 \; (N'(1) - \rho) \\
    \E{N_q^2} &= \E{N^2} - 2 \; \E{N} + \rho
\end{align*}
Como já temos o primeiro momento \(\E{N}\) calculado,
precisamos agora achar o segundo momento \(\E{N^2}\).
Derivando \(N(z)\) pela terceira vez vamos obter:
\begin{align*}
    N'''(z) \; (K(z) - z) + N''(z) \; (K'(z) - 1)
        + 2 \; N''(z) \; (K'(z) - 1) \\
        + 2 \; N'(z) \; (K''(z)) + N'(z) \; (K''(z))
        + N(z) \; (K'''(z)) \\
        = (1 - \rho) \; (-2 \; K''(z) - K''(z)
        + (1 - z) \; K'''(z))
\end{align*} \begin{align*}
    N'''(z) \; (K(z) - z) + 3 \; N''(z) \; (K'(z) - 1)
        + 3 \; N'(z) \; K''(z) \\
        + N(z) \; K'''(z) \\
        = (1 - \rho) \; (-3 \; K''(z) + (1 - z) \; K'''(z))
\end{align*}
Fazendo \(z = 1\):
\begin{align*}
    &3 \; N''(1) \; (K'(1) - 1)
        + 3 \; N'(1) \; K''(1) + K'''(1)
        = (1 - \rho) \; (-3 \; K''(1)) \\
    &3 \; N''(1) \; (1 - \lambda \; \E{X})
        - 3 \; N'(1) \; (\lambda^2 \; \E{X^2})
        - \lambda^3 \; \E{X^3}
        = (1 - \rho) \; (3 \; \lambda^2 \; \E{X^2}) \\
    &3 \; N''(1) \; (1 - \lambda \; \E{X})
        = (1 - \rho) \; (3 \; \lambda^2 \; \E{X^2})
        + 3 \; N'(1) \; (\lambda^2 \; \E{X^2})
        + \lambda^3 \; \E{X^3} \\
    &3 \; N''(1) \; (1 - \lambda \; \E{X})
        = (1 - \rho) \; (3 \; \lambda^2 \; \E[X^2])
        + \frac{3 \; (\lambda^2 \; \E{X^2}) \;
        ((1 - \rho) \; (2 \; \lambda \; \E{X})
        + \lambda^2 \; \E{X^2})}{2 \; (1 - \lambda \; \E{X})}\\
        &+ \lambda^3 \; \E{X^3} \\
\end{align*}
\begin{align*}
    &3\;N^{''}(1)\;(1-\lambda E[X]) = \\
    &\frac{6 \; (1 - \rho) \; (\lambda^2 \; \E{X^2}) \;
        (1 - \lambda \; \E{X}) + 3 \; (\lambda^2 \; \E{X^2})
        \; ((1 - \rho) \; (2 \; \lambda \; \E{X})
        + \lambda^2 \; \E{X^2})}{2 \; (1 - \lambda \; \E{X})}\\
        &+\frac{2 \; (1 - \lambda \; \E{X})
        \;(\lambda^3 \; \E{X^3})}{2 \; (1 - \lambda \; \E{X})}
\end{align*}
\begin{align*}
    &N''(1) = \\
    &\frac{6 \; (1 - \rho) \; (\lambda^2 \; \E{X^2})
        \; (1 - \lambda \; \E{X})
        + 3 \; (\lambda^2 \; \E{X^2}) \; ((1 - \rho)
        \; (2 \; \lambda \; \E[X]) + \lambda^2 \; \E{X^2})
        }{6 \; (1 - \lambda \; \E{X})^2}\\
        &+\frac{2 \; (1 - \lambda \; \E{X}) \; \lambda^3
        \; \E[X^3]}{6 \; (1 - \lambda \; \E{X})^2}
\end{align*}
Logo \(\E{N^2} = N''(1) + N'(1)\)
para uma fila M/M/1, pode ser dado por:
\begin{align*}
    &\frac{12 \; (1 - \rho)^2 \; \rho^2
        + 6 \; \rho^2 \; ((1 - \rho) \; 2 \; \rho
        + 2 \; \rho^2) + 12 \; (1 - \rho) \; \rho^3
        + 3 \; (1 - \rho) \; (2 \; \rho (1 - \rho)
        + 2 \; \rho^2)}{6 \; (1 - \rho)^2} \\
    &\frac{6 \; \rho - 6 \; \rho^2 + 12 \; \rho^2
        - 24 \; \rho^3 + 12 \; \rho^4 + 12 \; \rho^3
        + 12 \; \rho^3 - 12 \; \rho^4}{6 \; (1 - \rho)^2} \\
    &\frac{6 \; \rho^2 + 6 \; \rho}{6 \; (1 - \rho)^2} \\
    &\frac{\rho^2 + \rho}{(1 - \rho)^2}
\end{align*}
Agora podemos calcular \(E[N_q^{2}]\)
\begin{align*}
    \E{N_q^2} &= \frac{\rho^2 + \rho}{(1 - \rho)^2}
        - \frac{2 \; \rho}{(1 - \rho)} + \rho \\
    &= \frac{\rho^2 + \rho - 2 \;\rho + 2 \; \rho^2
        + \rho - 2 \; \rho^2 + \rho^3}{(1 - \rho)^2} \\
    &= \frac{\rho^2 + \rho^3}{(1 - \rho)^2}
\end{align*}
Por fim, calculamos a variância do número de pessoas
na fila de espera de uma M/M/1:
\begin{align*}
    V(N_q) &= \frac{\rho^2 + \rho^3}{(1 - \rho)^2}
        - (\frac{\rho^2}{1 - \rho})^2 \\
    &=\frac{\rho^2 + \rho^3 - \rho^4}{(1-\rho)^2}
\end{align*}

\subsection{Tempo médio em uma fila de espera FCFS}

Acompanhando um freguês tíıpico em uma fila M/G/1 FCFS,
podemos observar que o número deixado para trás é
exatamente o número de pessoas que chegou
durante o tempo \(T\) que o freguês típico passou no sistema.
Como o processo de chegada é Poisson
e relacionando as chegadas ao intervalo de tempo em
que as chegadas ocorreram,
pode-se escrever
\[
    N(z) = T(\lambda - \lambda \; z)
\]
Fazendo \(s = \lambda - \lambda \; z\)
e substituindo \(z = \frac{\lambda - s}{\lambda}\),
temos:
\[
    T^*(s) =
    \frac{(1 - \rho)\; s \; X^*(s)}{s - \lambda + \lambda \; X^*(s)}
\]
Sabemos que \(T = W + X\), como \(W\) e \(X\)
são independentes em uma fila FCFS,
então  \(T^*(s) =  W^*(s) \; X^*(s)\),
logo a transformada de Laplace
da pdf do tempo de espera na fila é dada por:
\[
    W^*(s) = \frac{(1 - \rho) \; s}{s - \lambda + \lambda \; X^*(s)}
\]
O tempo médio de espera na fila
pode ser facilmente obtido derivando \(W^{*}(s)\),
uma vez que \(E[W] = - W^{*'}(0)\).
Dessa forma, derivando em relação a \(s\) temos:
\begin{align*}
    W^*(s)(s - \lambda + \lambda \; X^*(s)) &= (1 - \rho) \; s \\
    {W^*}'(s) \; (s - \lambda + \lambda \; X^*(s))
        + W^*(s) \; (1 + \lambda \; {X^*}'(s)) &= (1 - \rho)
\end{align*}
Derivando novamente para retirar a ideterminação:
\begin{align*}
    {W^*}''(s) \; (s - \lambda + \lambda \; X^*(s))
        + {W^*}'(s) \; (1 + \lambda \; {X^*}'(s)) \\
        + {W^*}'(s) \; (1 + \lambda \; {X^*}'(s))
        + W^*(s) \; (\lambda \; {X^*}''(s)) = 0
\end{align*}
Fazendo \(s = 0\)
\begin{align*}
    2 \; {W^*}'(0) \; (1 + \lambda \; {X^*}'(0))
        &= - \lambda \; {X^*}''(0) \\
    {W^*}'(0)
        &= \frac{-\lambda \; {X^*}''(0)}{1 + \lambda \; {X^*}'(0)} \\
    \E{W} &= \frac{\lambda \; \E{X^2}}{2 \; (1 - \lambda \; \E{X})}
\end{align*}
Como \(\E{X^2} = 2 \; \E{X} \; \E{Xr}\),
podemos escrever
\(
    \E{W} = \frac{\lambda \; 2 \; \E{X} \; \E{Xr}}{2
        \; (1 - \lambda \; \E{X})}
\).
Para a fila M/M/1,
como temos um serviço exponencial,
\(E[Xr] = E[X]\),
logo \(\E{W} = \frac{\rho \; \E{X}}{(1 - \rho)}\).
Para o nosso simulador o tempo médio de serviço é 1 segundo,
então
\[
    \E{W} = \frac{\rho}{(1 - \rho)}
\]

\subsection{Variância do tempo de espera em uma fila de espera FCFS}
Para o cálculo da variância
é preciso achar o segundo momento \(\E{W^2} = {W^*}''(0)\).
Assim sendo, derivando \(W^*(s)\) pela terceira vez:
\begin{align*}
    {W^*}''(s) \; (s - \lambda + \lambda \; X^*(s))
        + {W^*}'(s) \; (1 + \lambda \; {X^*}'(s))
        + {W^*}'(s) \; (1 + \lambda \; {X^*}'(s))
        + W^*(s)(\lambda \; {X^*}''(s)) = 0 \\
    {W^*}'''(s) \; (s - \lambda + \lambda \; X^*(s))
        + {W^*}''(s) \; (1 + \lambda \; {X^*}'(s))
        + {W^*}''(s) \; (1 + \lambda \; {X^*}'(s))
        + {W^*}'(s) \; (\lambda \; {X^*}''(s)) \\
        + {W^*}''(s) \; (1 + \lambda \; {X^*}'(s))
        + {W^*}'(s) \; (\lambda \; {X^*}''(s))
        + {W^*}'(s) \; (\lambda \; {X^*}''(s))
        + W^*(s) \; (\lambda \; {X^*}'''(s)) = 0
    \end{align*}
Fazendo \(s = 0\):
\[
    3 \; {W^*}''(0) \; (1 + \lambda {X^*}''(s))
        + 3 {W^*}'(0) \; (\lambda \; {X^*}''(0))
        + \lambda \; {X^*}'''(0) = 0
\]
\begin{align*}
    3 \; {W^*}''(0) \; (1 - \lambda \; {X^*}''(s))
        &= -3 \; {W^*}'(0) \; (\lambda \; {X^*}''(0))
        - \lambda {X^*}'''(0) \\
    3 \; {W^*}''(0) \; (1 - \lambda \E{X^2})
        &= 3 \; \E{W} \; (\lambda \; \E{X^2})
        + \lambda \; \E{X^3} \\
    {W^*}''(0) &= \frac{3 \; \lambda \; \E{X^2}
        \; \lambda \; \E{X^2}}{6 \; (1 - \lambda \; \E{X^2})^2}
        + \frac{\lambda \; \E{X^3}}{3
        \; (1 - \lambda \; \E{X^2})} \\
    {W^*}''(0) &= \frac{\lambda \; \E{X^2} \; \lambda
        \; \E{X^2}}{2 \; (1 - \lambda \; \E{X^2})^2}
        + \frac{\lambda \; \E{X^3}}{3
        \; (1 - \lambda \; \E{X^2})} \\
    {W^*}''(0) &= 2 \; \E{W}^2
        + \frac{\lambda \; \E{X^3}}{3
        \; (1 - \lambda \; \E{X^2})} \\
    {W^*}''(0) &= E[W^2]
\end{align*}
Logo, para a fila M/M/1
\[
    \E{W^2}
    = 2 \; \E{W}^2 + \frac{\lambda \; \E{X^3}}{3 \; (1 - \rho)}
\]
Finalmente, podemos achar a variância para uma fila M/M/1 FCFS:
\begin{align*}
    V(W_{FCFS}) &= \E{W^2} - \E{W}^2 \\
    &= 2 \; \E{W}^2 + \frac{\lambda \; \E{X^3}}{3 \; (1 - \rho)}
        - \E{W}^2 \\
    &= \E{W}^2 + \frac{\lambda \; \E{X^3}}{3 \; (1 - \rho)} \\
    &= \frac{\lambda^2 \; \E{X^2}^2}{4 \; (1 - \rho)^2}
        + \frac{\lambda \; \E{X^3}}{3 \; (1 - \rho)} \\
    &= \frac{3 \; \lambda^2 \; \E{X^2}^2 + 4 \; \lambda \; \E{X^3}
        - 4 \; \rho \; \lambda \; \E{X^3}}{12 \; (1 - \rho)^2}
    \end{align*}
Como o tempo médio de serviço é 1 segundo, \(\lambda = \rho\)
\[
    V(W_{FCFS}) = \frac{3 \; \rho^2 \; \E{X^2}^2
        + 4 \; \rho \; \E{X^3} - 4 \; \rho^2 \; \E{X^3}}{12
        \; (1 - \rho)^2}
\]
O segundo e o terceiro momentos de uma exponencial,
com \(\mu = 1\) podem ser dados por:
% TODO: BOTAR INTEGRAL
\begin{align*}
    &\E{X^2} \int = \frac{2}{\mu^2 } = 2 \\
    &\E{X^3} \int = \frac{6}{\mu^3 } = 6
\end{align*}
Então,
\[
    V(W_{FCFS})
    = \frac{-12 \; \rho^2 + 24 \; \rho}{12 \; (1 - \rho)^2} = \frac{-\rho^2 + 2 \; \rho}{(1 - \rho)^2}
\]
\subsection{Tempo médio em uma fila de espera LCFS}
Quando um freguêes típico chega à fila, o instante de chegada
é equivalente a uma amostragem aleatória no tempo (PASTA)
e a fila  é encontrada com seus valores médios no tempo,
tanto na fila de espera quanto no serviço.
O serviço médio pendente neste instante  é dado
por \(\E{U_0} = \E{N_q}\;\E{X} + \E{N_s}\;\E{Xr}\), com \(\E{N_q} = \lambda\;\E{W}\).

Deste serviço pendente, a parte \(\E{W_0} = \E{N_s}\;\E{Xr} = \rho\;\E{Xr}\)
ser;a executada antes da entrada do freguês típico em serviço.
Caso novas chegadas nãpo ocorressem após a chegada
do freguês típico, o tempo médio de espera seria dado simplesmente
pelo atraso \(\E{W_0}\). A expressão para \(\E{W_0}\) pode ser também
obtida condicionando no estado ocupado ou ocioso
encontrado ao chegar:
\[
    \E{W_0} = \E{W_0|ocupado} \; P(ocupado) + \E{W_0|ociso} \; P(ocioso) = \rho\;\E{Xr}
\]
Se a fila  é encontrada ociosa o atraso até entrada em serviço  é zero e se o servidor
está ocupado o serviço residual  é o atraso mínimo a ser observado.
Entretanto, toda nova chegada que ocorre enquanto o fregues típico
ainda está na fila deespera será servida antes do freguês típico.
O tempo médio de espera na fila pode ser visto
como um período ocupado diferenciado iniciado por \(\E{W_0}\), logo:
\[
    \E{W_{LCFS}} = \frac{ \E{W_0}}{ 1-\rho} = \frac{ \rho\;\E{Xr}}{ 1-\rho},\;\rho < 1
\]
Como na fila M/M/1 \(\E{Xr} = \E{X}\), pela propriedade da falta de memória, e  \(\E{X} =1s\)
\(\E{W_LCFS}\) pode ser escrito como \(\E{W_{LCFS}} =  \frac{ \rho}{ 1-\rho}\), que
é o mesmo tempo médio de espera em uma fila FCFS, como esperado e discutido em aula.
\subsection{Variância do tempo de espera em uma fila LCFS}
Para calcular a variância do tempo de espera em uma fila LCFS, precisamos obter
a sua transfromada \(W_{LCFS}^*(s)\), que pode ser obtida diretamente da T.L
do período ocupado, condicionando no estado ocupado ou ocioso que a fila  é encontrada pelo freguês tépico.
Quando o sistema é encontrado ocupado, o serviço inicial do período ocupado  é dado pela vida residual do
serviço, que no caso da fila M/M/1 é o proprio serviço.
\begin{align*}
    W_{LCFS}^*(s) &= \E{e^{s\;W_{LCFS}}|ocupado} \; P(ocupado) + \E{e^{s\;W_{LCFS}}|ocioso} \; P(ocioso)\\
    &= \rho\;  X^*(s+\lambda- \lambda\;G^*(s)) + (1-\rho)\\
    &=  \rho\; G^*(s) + (1-\rho)
\end{align*}
Derivando uma vez e fazendo s = 0 obetmos o primeiro momento:
\[
{W_{LCFS}^*}'(0) =  \rho\; {G^*}'(0) = \frac{ \rho\;\E{X}}{ 1-\rho}
\]
Como esperado e visto anteriormente. Agora derivamos novamente, para achar o segundo momento:
\[
{W_{LCFS}^*}''(0) =  \rho\; {G^*}''(0) = \frac{ \rho\;\E{X^2}}{(1-\rho)^3}
\]
Para achar a variância :
\begin{align*}
V(W_{LCFS})&= \frac{ \rho\;\E{X^2}}{(1-\rho)^3} - (\frac{ \rho\;\E{X}}{ 1-\rho})^2\\
&= \frac{ 2\; \rho}{(1-\rho)^3} - (\frac{ \rho}{ 1-\rho})^2\\
&=\frac{ 2\; \rho -\rho^2 + \rho^3}{(1-\rho)^3}
\end{align*}

Ao final obtivemos os seguintes valores analíticos:

\begin{table}[h]
\centering
\caption{Valores analíticos}
\vspace{0.9cm}
\begin{tabular}{r|lr}

Variável & Média & Variância \\ % Note a separação de col. e a quebra de linhas
\hline                               % para uma linha horizontal
\(W_{LCFS}\) & \(\frac{ \rho}{ 1-\rho}\)  & \(\frac{ 2\; \rho -\rho^2 + \rho^3}{(1-\rho)^3}\) \\
\(W_{FCFS}\) & \(\frac{ \rho}{ 1-\rho}\)  & \(\frac{2 \; \rho -\rho^2 }{(1 - \rho)^2}\) \\
\(N_q\)      & \(\frac{ \rho^2}{ 1-\rho}\)& \(\frac{\rho^2 + \rho^3 - \rho^4}{(1 - \rho)^2}\) \\

\end{tabular}
\end{table}
\newpage
\section{Tabelas com Resultados e Comentários Pertinentes}
%\newpage
\section{Conclusão}
%\newpage
\section{Anexo - Listagem Documentada do Programa}

\end{document}
